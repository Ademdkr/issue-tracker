<div class="general-settings-form-container" (click)="onBackdropClick($event)">
  <!-- Form Card -->
  <div class="settings-form-card" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="form-header">
      <mat-icon>settings</mat-icon>
      <h2>General Einstellungen</h2>

      <!-- Close Button -->
      <button
        mat-icon-button
        class="close-button"
        type="button"
        (click)="onClose()"
        aria-label="Schließen"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Form Content -->
    <form
      [formGroup]="settingsForm"
      class="settings-form"
      (ngSubmit)="onSubmit()"
    >
      <!-- Projektname (Editable) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Projektname</mat-label>
        <input
          matInput
          formControlName="name"
          placeholder="z.B. E-Commerce Platform"
        />
        <mat-icon matPrefix>label</mat-icon>
        <mat-hint *ngIf="!canEdit" class="readonly-hint">
          <mat-icon class="hint-icon">lock</mat-icon>
          Nur Manager und Admins können den Namen bearbeiten
        </mat-hint>
        <mat-error *ngIf="settingsForm.get('name')?.hasError('required')">
          Projektname ist erforderlich
        </mat-error>
        <mat-error *ngIf="settingsForm.get('name')?.hasError('minlength')">
          Mindestens 3 Zeichen erforderlich
        </mat-error>
      </mat-form-field>

      <!-- Beschreibung (Editable) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Beschreibung</mat-label>
        <textarea
          matInput
          formControlName="description"
          rows="4"
          placeholder="Beschreiben Sie das Projekt..."
        ></textarea>
        <mat-icon matPrefix>description</mat-icon>
        <mat-hint *ngIf="!canEdit" class="readonly-hint">
          <mat-icon class="hint-icon">lock</mat-icon>
          Nur Manager und Admins können die Beschreibung bearbeiten
        </mat-hint>
        <mat-error
          *ngIf="settingsForm.get('description')?.hasError('required')"
        >
          Beschreibung ist erforderlich
        </mat-error>
      </mat-form-field>

      <!-- Slug (Admin editable, others readonly) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Slug (URL-Identifier)</mat-label>
        <input
          matInput
          formControlName="slug"
          placeholder="z.B. ECOMMERCE-PLATFORM"
        />
        <mat-icon matPrefix>link</mat-icon>
        <mat-hint *ngIf="!isAdmin" class="readonly-hint">
          <mat-icon class="hint-icon">lock</mat-icon>
          Nur Admins können den Slug bearbeiten
        </mat-hint>
        <mat-error *ngIf="settingsForm.get('slug')?.hasError('required')">
          Slug ist erforderlich
        </mat-error>
        <mat-error *ngIf="settingsForm.get('slug')?.hasError('pattern')">
          Nur Großbuchstaben, Zahlen und Bindestriche erlaubt
        </mat-error>
      </mat-form-field>

      <!-- Read-only Information -->
      <div class="readonly-section">
        <h3 class="section-title">
          <mat-icon>info</mat-icon>
          Projekt-Informationen
        </h3>

        <!-- Erstellt von -->
        <div class="info-field">
          <label class="info-label">
            <mat-icon>person</mat-icon>
            Erstellt von
          </label>
          <div class="info-value">
            {{ project.createdBy.name }} {{ project.createdBy.surname }}
          </div>
        </div>

        <!-- Erstellt am -->
        <div class="info-field">
          <label class="info-label">
            <mat-icon>event</mat-icon>
            Erstellt am
          </label>
          <div class="info-value">
            {{ getFormattedDate(project.createdAt) }}
          </div>
        </div>

        <!-- Aktualisiert am -->
        <div class="info-field" *ngIf="project.updatedAt">
          <label class="info-label">
            <mat-icon>update</mat-icon>
            Aktualisiert am
          </label>
          <div class="info-value">
            {{ getFormattedDate(project.updatedAt) }}
          </div>
        </div>

        <!-- Statistiken -->
        <div class="info-stats">
          <div class="stat-item">
            <mat-icon>confirmation_number</mat-icon>
            <span>{{ project.ticketCount }} Tickets</span>
          </div>
          <div class="stat-item">
            <mat-icon>group</mat-icon>
            <span>{{ project.memberCount }} Mitglieder</span>
          </div>
        </div>
      </div>
    </form>

    <!-- Actions -->
    <div class="form-actions">
      <!-- Links: Abbrechen -->
      <button
        mat-button
        type="button"
        (click)="onClose()"
        class="cancel-button"
      >
        <mat-icon>close</mat-icon>
        Abbrechen
      </button>

      <!-- Mitte: Aktionen -->
      <button
        *ngIf="canEdit"
        mat-stroked-button
        [color]="project.status === 'OPEN' ? 'warn' : 'accent'"
        type="button"
        (click)="onToggleStatus()"
        class="toggle-status-button"
      >
        <mat-icon>{{ project.status === 'OPEN' ? 'lock' : 'lock_open' }}</mat-icon>
        {{ project.status === 'OPEN' ? 'Projekt schließen' : 'Projekt wieder öffnen' }}
      </button>

      <button
        *ngIf="isAdmin"
        mat-stroked-button
        color="warn"
        type="button"
        (click)="onDelete()"
        class="delete-button"
      >
        <mat-icon>delete</mat-icon>
        Projekt löschen
      </button>

      <span class="spacer"></span>

      <!-- Rechts: Speichern -->
      <button
        mat-raised-button
        color="primary"
        type="submit"
        (click)="onSubmit()"
        [disabled]="!canEdit || !settingsForm.valid || !settingsForm.dirty"
        class="save-button"
      >
        <mat-icon>save</mat-icon>
        Änderungen speichern
      </button>
    </div>
  </div>
</div>
